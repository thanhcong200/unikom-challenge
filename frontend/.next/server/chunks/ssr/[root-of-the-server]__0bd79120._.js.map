{"version":3,"sources":["turbopack:///[project]/src/utils/auth.tsx","turbopack:///[project]/src/pages/_app.tsx"],"sourcesContent":["'use client'\r\nimport React, { createContext, useContext, useEffect, useState } from 'react'\r\nimport axios from 'axios'\r\n\r\n\r\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:4000/api'\r\n\r\n\r\ntype User = {\r\n    id: number\r\n    first_name: string\r\n    last_name: string\r\n    email: string\r\n}\r\n\r\n\r\ntype AuthContextType = {\r\n    user: User | null\r\n    token: string | null\r\n    login: (email: string, password: string, remember?: boolean) => Promise<void>\r\n    signup: (payload: any) => Promise<void>\r\n    logout: () => Promise<void>\r\n}\r\n\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined)\r\n\r\n\r\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [user, setUser] = useState<User | null>(null)\r\n    const [token, setToken] = useState<string | null>(null)\r\n\r\n\r\n    useEffect(() => {\r\n        const t = typeof window !== 'undefined' ? localStorage.getItem('token') : null\r\n        if (t) {\r\n            setToken(t)\r\n            axios.get(`${API_BASE}/auth/me`, { headers: { Authorization: `Bearer ${t}` } })\r\n                .then(r => setUser(r.data))\r\n                .catch(() => {\r\n                    setToken(null)\r\n                    localStorage.removeItem('token')\r\n                })\r\n        }\r\n    }, [])\r\n\r\n\r\n    const login = async (email: string, password: string, remember = false) => {\r\n        const res = await axios.post(`${API_BASE}/auth/login`, { email, password })\r\n        const t = res.data.token\r\n        setToken(t)\r\n        if (remember) localStorage.setItem('token', t)\r\n        else sessionStorage.setItem('token', t)\r\n        const me = await axios.get(`${API_BASE}/auth/me`, { headers: { Authorization: `Bearer ${t}` } })\r\n        setUser(me.data)\r\n        // log activity is backend responsibility (should log login)\r\n    }\r\n\r\n\r\n    const signup = async (payload: any) => {\r\n        await axios.post(`${API_BASE}/auth/signup`, payload)\r\n    }\r\n\r\n\r\n    const logout = async () => {\r\n        try {\r\n            if (token) await axios.post(`${API_BASE}/auth/logout`, {}, { headers: { Authorization: `Bearer ${token}` } })\r\n        } finally {\r\n            setUser(null)\r\n            setToken(null)\r\n            localStorage.removeItem('token')\r\n            sessionStorage.removeItem('token')\r\n        }\r\n    }\r\n\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ user, token, login, signup, logout }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    )\r\n}\r\n\r\n\r\nexport const useAuth = () => {\r\n    const ctx = useContext(AuthContext)\r\n    if (!ctx) throw new Error('useAuth must be used within AuthProvider')\r\n    return ctx\r\n}","import \"../styles/globals.css\";\r\nimport type { AppProps } from 'next/app'\r\nimport { AuthProvider } from '../utils/auth'\r\n\r\n\r\nexport default function MyApp({ Component, pageProps }: AppProps) {\r\n    return (\r\n        <AuthProvider>\r\n            <Component {...pageProps} />\r\n        </AuthProvider>\r\n    )\r\n}"],"names":[],"mappings":"kSACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,wCAGA,IAAM,EAAW,SAAA,mBAoBX,EAAc,CAAA,CApBgC,CAoBhC,EAAA,aAAA,AAAa,OAA8B,yBAGM,CAAC,UAAE,CAAQ,CAAE,IAC9E,GAAM,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,MACxC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAGlD,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KAWV,EAAG,EAAE,EAGL,IAAM,EAAQ,MAAO,EAAe,EAAkB,GAAW,CAAK,IAElE,IAAM,EAAI,CADE,MAAM,EAAA,OAAK,CAAC,IAAI,CAAC,CAAA,EAAG,EAAS,WAAW,CAAC,CAAE,OAAE,WAAO,CAAS,EAAA,EAC3D,IAAI,CAAC,KAAK,CACxB,EAAS,GACL,EAAU,aAAa,OAAO,CAAC,QAAS,GACvC,eAAe,OAAO,CAAC,QAAS,GACrC,IAAM,EAAK,MAAM,EAAA,OAAK,CAAC,GAAG,CAAC,CAAA,EAAG,EAAS,QAAQ,CAAC,CAAE,CAAE,QAAS,CAAE,cAAe,CAAC,OAAO,EAAE,EAAA,CAAG,AAAC,CAAE,GAC9F,EAAQ,EAAG,IAAI,CAEnB,EAGM,EAAS,MAAO,IAClB,MAAM,EAAA,OAAK,CAAC,IAAI,CAAC,CAAA,EAAG,EAAS,YAAY,CAAC,CAAE,EAChD,EAGM,EAAS,UACX,GAAI,CACI,GAAO,MAAM,EAAA,OAAK,CAAC,IAAI,CAAC,CAAA,EAAG,EAAS,YAAY,CAAC,CAAE,CAAC,EAAG,CAAE,QAAS,CAAE,cAAe,CAAC,OAAO,EAAE,EAAA,CAAO,AAAC,CAAE,EAC/G,QAAU,CACN,EAAQ,MACR,EAAS,MACT,aAAa,UAAU,CAAC,SACxB,eAAe,UAAU,CAAC,QAC9B,CACJ,EAGA,MACI,CAAA,EAAA,EAAA,GAAA,EAAC,EAAY,QAAQ,CAAA,CAAC,MAAO,MAAE,QAAM,EAAO,eAAO,SAAQ,CAAO,WAC7D,GAGb,cAGuB,KACnB,IAAM,EAAM,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,GACvB,GAAI,CAAC,EAAK,MAAM,AAAI,MAAM,4CAC1B,OAAO,CACX,yECtFA,EAAA,EAAA,CAAA,CAAA,eAGe,SAAS,EAAM,WAAE,CAAS,WAAE,CAAS,CAAY,EAC5D,MACI,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,YAAY,CAAA,UACT,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAW,GAAG,CAAS,IAGpC"}